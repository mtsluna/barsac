<div class="relative mb-14">
  <app-back-button></app-back-button>

  <div class="p-4" [formGroup]="formGroup">
    <h1 class="text-xl font-bold mb-2">Tu dirección</h1>
    <h2 class="text-me text-gray-500 mb-4">Ingresa los detalles de tu dirección</h2>

    <!-- Google Places Autocomplete Input -->
    <label class="block mb-2 font-medium">Dirección</label>
    <input formControlName="address" #addressInput id="autocomplete" type="text" class="w-full p-2 border rounded mb-2 placeholder:text-gray-500 focus:outline-black" placeholder="Busca tu dirección" autocomplete="off">
    @if (formGroup.get('address')?.hasError('addressMismatch')) {
      <div class="text-red-500 text-sm font-light pb-4">
        Ingrese una dirección válida.
      </div>
    }

    <!-- Google Map below address field -->
    @if (isGoogleReady()) {
      <div class="mb-4 min-h-[250px]">
        <google-map [center]="center" [height]="'250px'" [width]="'100%'" [zoom]="15" >
          <map-marker [position]="center"></map-marker>
        </google-map>
      </div>
    } @else {
      <div class="mb-4 min-h-[250px]">
        <div class="w-full h-[250px] bg-gray-200 rounded animate-pulse"></div>
      </div>
    }

    <!-- Address Detail Input -->
    <label class="block mb-2 font-medium">Piso / Departamento</label>
    <input formControlName="detail" type="text" class="w-full p-2 border rounded mb-4 placeholder:text-gray-500 focus:outline-black" placeholder="Ej: Piso 2, Depto B">

    <!-- Reference Input -->
    <label class="block mb-2 font-medium">Instrucciones</label>
    <input formControlName="reference" type="text" class="w-full p-2 border rounded mb-4 placeholder:text-gray-500 focus:outline-black" placeholder="Ej: Puerta negra">

    <!-- Address verification banner -->
    @if (isVerifying()) {
      <div class="mb-4 flex items-center justify-center py-2">
        <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-gray-900 mr-2"></div>
        <span class="text-sm text-gray-600">Verificando cobertura...</span>
      </div>
    }

    @if (isAddressVerified() === false) {
      <div class="mb-4">
        <span class="inline-flex items-center rounded-md bg-red-50 px-2 py-1 text-xs font-medium text-red-700 ring-1 ring-red-600/10 ring-inset">
          <div>Lo sentimos, no llegamos con nuestros envios a tu dirección. En caso de necesitar un envio especial, podes enviarnos un<a href="https://wa.me/5492614600070?text=Hola, quiero hacer un pedido!" class="underline ml-1">whatsapp</a></div>
        </span>
      </div>
    }
  </div>

  <app-next-button [disabled]="formGroup.invalid || isAddressVerified() === false || isVerifying()" [action]="save()" [ngClass]="getButtonPositionClass()" class="fixed left-4 w-full" title="Guardar" subtitle="Estas a un paso de crearla"></app-next-button>
</div>
